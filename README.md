# eTilbudsavis - Android SDK

# Introduction
This is a short guide to guide you through our Android SDK. We will assume you
are using [eclipse](http://www.eclipse.org/) and the [Android Development Tools](http://developer.android.com/tools/sdk/eclipse-adt.html) plugin. 
Furthermore you are goind to need an API key and secret from [found here](https://etilbudsavis.dk/developers/api/).
Lastly we have included a ETA SDK Demo app in the repository. It demonstrates 
some basic features, some of which are also described in this README.

If you want to get started quickly, just clone the [native-android-sdk](https://github.com/eTilbudsavis/native-android-sdk.git) repository.
Start a new Android Application Project and import the ETA SDK into Eclipse as a library via the menu `Project -> Properties -> Android`.

- [Eta](#eta)
- [Location](#location)
- [Api](#api)
- [Pageflip](#pageflip)
- [Session](#session)
- [Shoppinglist Manager](#shoppinglist-manager)
- [Eta Objects](#eta-objects)


# Usage

The SDK offers several classes, for different purposes (some contain state, some are worker classes.
Here we will give a short presentation of each class, it's purpose and functionality.
For any information on API specifics please refer to our engineering page: [eta-api](http://engineering.etilbudsavis.dk/eta-api/)


## Eta
This is the main Class. Before you can start using the SDK, you must set the `Eta` object. This only needs to be done once
because the `Eta` object is a singleton. The singleton pattern assures that the database, session and other settings are not
ending up in a corrupt state.

	Eta.getInstance().set("YOUR_API_KEY", "YOUR_API_SECRET", Context);

The `Eta` class, must also be part of your app's Lifecycle, which means that `onResume()` and `onPause()`
must be called on the `mEta` object, this ensures all preferences are saved correctly, and database connections are
opened/closed.

	@Override
	protected void onResume() {
		super.onResume();
		Eta.getInstance().onResume();
	}

	@Override
	protected void onPause() {
		super.onPause();
		Eta.getInstance().onPause();
	}


To ebable the debug output, just set it to `true`:

	Eta.getInstance().debug(true);


The `eta` object offers several usefull methods, see each Class for details:

- `api()` - get a fresh `Api` object, from which you can easily generate an Api request.
- `getUser()` - Get the current user logged in.
- `getLocation()` - To get the location that the SDK uses for queries, location should always be set, or the API won't respond.
- `getSession()` - The session is automatically generated by the SDK, and is needed for communication with the API.
- `getShoppinglistManager()` - This is a very convinient class, and allows to easily create an shoppinglist for both offline as well as online synchronization.
- `debug(boolean useDebug)` - Use this to enable debugging output to LogCat. NOTE: no debugging output will be displayed, if this isn't set to `true`

We have an array of convenience methods, for the most commonly used methodcalls to the API, all located in the `eta` object.
They all return an `Api` object, that can have further options enabled before `execute()`is called.
They are mostly selfexplainatory from their method names, and parameters. And for further details, i'll refer to the JavaDoc.

- `getCatalog` - methods will get some type of `Catalog` either an object or list, based on the exact method.
- `getOffer*` - methods will get some type of `Offer` either an object or list, based on the exact method.
- `getDealer*` - methods will get some type of `Dealer` either an object or list, based on the exact method.
- `getStore*` - methods will get some type of `Store` either an object or list, based on the exact method.
- `searchCatalog*` - search interface for `Catalog`
- `searchOffer*` - search interface for `Offer`
- `searchDealer*` - search interface for `Dealer`
- `searchStore*` - search interface for `Store`


## Location
The EtaLocation object, is a pure state object, and is where you want to store any Location information.
Without a valid location set, the API won't respond with any data, as the whole service is geolocation based.

To set a valid location, you must provide at least a `latitude`, `longitude` and a `radius`.
If you are using `LocationManager` you can pass any new `location` objects directly into `EtaLocation`.

`EtaLocation` will save the last known location to shared preferences, so a valid location is always accessible,
once an initial location have been given.

## Api
You can include various options into the api.request() call, just create a Bundle 
with key/value pairs, and send it as a parameter. See more about REST API options
[here](https://etilbudsavis.dk/developers/docs/).

### Api Listeners
We've created a neat callback interface, for returning data for you, so you don't have to do any work.
Basically, you just define the type of data you want returned, and we'll get it for you. So if you want
to get a catalog, just pass the `Api` a `ItemListener<Catalog>`:

	ItemListener<Catalog> listener = new ItemListener<Catalog> {
		
		@Override
		public void onComplete(boolean isCache, int statusCode, Catalog item, EtaError error) {
		}
	}

We have defined 5 basic interfaces for returning data:

- `ItemListener<T extends EtaErnObject>` returns an `Object` of type `T`, where `T` can be of any type that extends `EtaErnObject`, see [Eta Objects](#eta-objects)
- `ListListener<T extends EtaErnObject>` returns an `List` of type `T`, where `T` can be of any type that extends `EtaErnObject`, see [Eta Objects](#eta-objects)
- `ItemListener<JSONObject>` returns a `JSONObject`
- `ListListener<JSONArray>` returns a `JSONArray`
- `ApiListener<String>` returns the result as `String`


## Pageflip
Pageflip, is basically just a simple and smooth catalog viewer. With a simple yet effective interface.
The Pageflip view, can be added to any XML layout you're using in eclipse, either via the GUI editor,
under _Custom and Library Views->Pageflip_ or with this XML tag:
	
	<com.eTilbudsavis.etasdk.Pageflip />

The `Pageflip` must be executed like other elements in the SDK with the `execute()` method. This way, you'll 
have full control of setting up any options, you want before actually loading the `Pageflip`, and make sure that
you to decide what happens, and when. See a simple working example of how to interact with the `Pageflip`, in the SDKDemo (bundled in the SDK).

### Events
`Pageflip` takes a `PageflipListener`, through which you will recieve information about the actions the user
performs on the view. The current list of events, and corresponding JSONObjects can be found [here](http://engineering.etilbudsavis.dk/eta-web-app/#eta-catalog-view).

## Session
All API requests require a valid Session, and the session must opdate based on headers from the API. 
Furthermore, Session is a shared state between client and server, and also describes what permissions a given user/session has.

_luckily the SDK takes care of all of this, so you don't have to_ :-)

The commonly used methods in the session are:

- `login()` - For logging in a user
- `loginFacebook()` - For loggingin via Facebook (This requires you to implement the Facebook Android SDK)
- `forgotPassword()` - To retrieve a forgotton password
- `createUser()` - Create a new eTilbudsavis user
- `signout()` - Sign a user out.

Furthermore the Session has a subscriber system, so anyone (class) who want's notification on state change will be notified via an `SessionListener`.
To subscribe/unsubscribe, use `subscribe()` and `unSubscribe()` methods respectively.

<big>Session is not yet intended for a multi user setup</big>


## Shoppinglist Manager
Though some functionality is developed, and integrated allready, the `ShoppinglistManager` isn't fully implemented yet. And you can experience some odd behavior at times.

## Caching
We have strived to make the API as well as the SDK as fast as possible, therefore we have implemented
caching of all objects, that is by nature cachable. This includes all objects which is identified by an "ern" (unique identifier). But never any list calls, as these are subject to change far more than identifiable objects.

This is on by default, and you don't have to do anything to harvest the benefits of this.

Cached callbacks can be identified, by the argument `isCache` present in the callback interface for the `Api` requests.
The callback interface will actually give you both the cached result as well as the API data, unless you set a flag on the `Api` object, stating otherwise (`ONLY_RETURN_CACHE`).

## Eta Objects
The SDK comes with a full set of Java Objects, to match responses from the API.
Where the base Class is `EtaObject`, all other classes inherits from this class.

There is a special group of identifiable classes, which has a unique identifier called `ern` as a key in the JSON response. 
These objects extends from the `EtaErnObject` and are the "base" for all objects, in the sense that they are what you are actually quering the API for.
The objects are:

- `Catalog`
- `Offer`
- `Dealer`
- `Store`
- `Shoppinglist`
- `ShoppinglistItem`
- `EtaError`

The objects will in someway contain parts of all other objects, that have been included in this SDK.

# Utilities
The Utils class, has a static set of methods, that you will hopefully find usefull during development.

It contains simple tools for input validation (e-mail, name, gender e.t.c.), data transformation (bundle to JavaScript string, SHA256 hasher e.t.c.) and easily printing API responses to LogCat.


# Feedback
If you have any feedback or comments feel free to contact danny@etilbudsavis.dk :-)
